#include <16f877a.h>
#include <math.h>  // Para usar atan

#fuses HS, NOWDT, NOPROTECT, NOPUT, NOLVP, NOBROWNOUT
#use delay(clock=20000000)
#use I2C(MASTER, SDA=PIN_C4, SCL=PIN_C3, SLOW)

#use standard_io(D)
#use standard_io(A)
#define use_servo_1 
#define use_servo_2
// Definiciones de pines para los servos
#define servo_1 PIN_A0
#define servo_2 PIN_A1

#include <lcd.c>         // Librería para el manejo de la LCD
#include <MPU6050.c>     // Librería para el manejo del MPU6050
#include <servo_st.c>    // Librería adicional para el manejo de servos

float Ax, Ay, Az, Gx, Gy, Gz, t;

void main() {
    lcd_init();         // Inicializa la pantalla LCD
    servo_init();       // Inicializa el control de los servos
    MPU6050_init();     // Inicializa el MPU6050

    printf(lcd_putc, " BIENVENIDO");
    delay_ms(1000);
    printf(lcd_putc, "\fvoy a cero");
    delay_ms(1000);
    servo_1_write(0);
    // Esperar 5 segundos con los servos en 90 grados
    delay_ms(1000);
    servo_2_write(0);
    delay_ms(1000);
    // Configurar los servos inicialmente en 90 grados
    int angle_x = 90;
    int angle_y = 90;
    
    printf(lcd_putc, "\fvoy a 90");
    delay_ms(1000);
    servo_1_write(angle_x);
    // Esperar 5 segundos con los servos en 90 grados
    delay_ms(1000);
    servo_2_write(angle_y);
    delay_ms(1000);
    // Bucle principal
    while (true) {
        // Obtener datos del MPU6050
        Ax = MPU6050_get_Ax();
        Ay = MPU6050_get_Ay();
        Az = MPU6050_get_Az();
        Gx = MPU6050_get_Gx();
        Gy = MPU6050_get_Gy();
        Gz = MPU6050_get_Gz();
        t = MPU6050_get_Temp();

        // Mostrar datos en la pantalla LCD
        lcd_gotoxy(1, 1);
        printf(lcd_putc, "Ax:%0.2f Ay:%0.2f", Ax, Ay);
        
        lcd_gotoxy(1, 2);
        printf(lcd_putc, "Gx:%0.2f Gy:%0.2f", Gx, Gy);

        delay_ms(1000);
    }}

